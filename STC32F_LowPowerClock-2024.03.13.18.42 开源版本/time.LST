C251 COMPILER V5.60.0,  time                                                               25/04/24  00:23:37  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE time
OBJECT MODULE PLACED IN time.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE time.c XSMALL OPTIMIZE(9,SPEED) BROWSE DEBUG TABS(2) 

stmt  level    source

    1          #include "time.h"
    2          #include "DATA.h"
    3          #include "OLED.h"
    4          
    5          /****************************** ç¡çœ å¯„å­˜å™¨ç»„ ***********************************/
    6          extern u16 Sleep_Queue[Sleep_queue_num];
    7          
    8          
    9          /****************************** ç¡çœ å¯„å­˜å™¨ç»„ ***********************************/
   10          extern u16 Sleep_Queue[Sleep_queue_num];
   11          
   12          //========================================================================
   13          // å‡½æ•°: Timer0Init(void)
   14          // æè¿°: ä¸²å£1å®šæ—¶å™¨
   15          // å‚æ•°: 
   16          // è¿”å›: 
   17          // ç‰ˆæœ¬: 
   18          // æ—¥æœŸ: 2013-4-1
   19          // å¤‡æ³¨:STCä¸‹è½½å™¨è‡ªåŠ¨ç”Ÿæˆ
   20          //========================================================================
   21          void Timer0Init(void)   //1æ¯«ç§’@35MHz
   22          {
   23   1          AUXR |= 0x80;   //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
   24   1          TMOD &= 0xF0;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
   25   1          TL0 = 0x48;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
   26   1          TH0 = 0x77;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
   27   1          TF0 = 0;    //æ¸…é™¤TF0æ ‡å¿—
   28   1          ET0 = 1;    //ä½¿èƒ½å®šæ—¶å™¨ä¸­æ–­
   29   1          TR0 = 1;    //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
   30   1      }
   31          
   32          
   33          
   34          //========================================================================
   35          // å‡½æ•°: void delay_ms(u8 ms)
   36          // æè¿°: å»¶æ—¶å‡½æ•°ã€‚
   37          // å‚æ•°: ms,è¦å»¶æ—¶çš„msæ•°, è¿™é‡Œåªæ”¯æŒ1~255ms. è‡ªåŠ¨é€‚åº”ä¸»æ—¶é’Ÿ.
   38          // è¿”å›: 
   39          // ç‰ˆæœ¬: 
   40          // æ—¥æœŸ: 2013-4-1
   41          // å¤‡æ³¨:STCä¾‹ç¨‹æä¾›
   42          //========================================================================
   43          void delay_ms(u8 ms)
   44          {
   45   1          u16 i;
   46   1          do {
   47   2              i = MAIN_Fosc / 10000;
   48   2              while(--i);   //10T per loop
   49   2          } while(--ms);
   50   1      }
   51          
   52          
   53          
   54          //========================================================================
   55          // å‡½æ•°: Delay10us()
   56          // æè¿°: ç­‰å¾…10us
   57          // å‚æ•°: 
   58          // è¿”å›: 
   59          // ç‰ˆæœ¬: 
C251 COMPILER V5.60.0,  time                                                               25/04/24  00:23:37  PAGE 2   

   60          // æ—¥æœŸ: 2013-4-1
   61          // å¤‡æ³¨:
   62          //========================================================================
   63          void Delay10us()    
   64          {
   65   1          unsigned long i;
   66   1      
   67   1          _nop_();
   68   1          _nop_();
   69   1          _nop_();
   70   1          i = 173UL;
   71   1          while (i) i--;
   72   1      }
   73          
   74          
   75          //========================================================================
   76          // å‡½æ•°: void Sleep_delay_us(u8 ms)
   77          // æè¿°: æ‰ç”µå”¤é†’å»¶æ—¶å‡½æ•°ã€‚
   78          // å‚æ•°: ms
   79          // è¿”å›: none.
   80          // ç‰ˆæœ¬: VER1.0
   81          // æ—¥æœŸ: 2013-4-1
   82          // å¤‡æ³¨: è¾“å…¥1çº¦ä¸º0.5ms
   83          //========================================================================
   84          void Sleep_delay_HalfMs(u16 ms)
   85          {
   86   1          if(ms <= 32767)
   87   1          {
   88   2              ms |= 0x8000;
   89   2              WKTCL = (ms | 0x0001);
   90   2              WKTCH = ms>>8;
   91   2          }
   92   1      }
   93          
   94          
   95          
   96          
   97          
   98          
   99          
  100          //========================================================================
  101          // å‡½æ•°: Sleep_delay_Time(u16 sleep_dat)
  102          // æè¿°: æ‰ç”µä¼‘çœ æŒ‡å®šçš„æ—¶é—´ï¼Œæœ‰é‡è£…å¡«åŠŸèƒ½
  103          // å‚æ•°: sleep_dat    1 â‰ˆ 500us
  104          // è¿”å›: 
  105          // ç‰ˆæœ¬: 
  106          // æ—¥æœŸ: 2013-4-1
  107          // å¤‡æ³¨:
  108          //========================================================================
  109          void Sleep_delay_Time(u16 sleep_dat)
  110          {
  111   1          u16 kk=0;
  112   1          u16 uu = 0;
  113   1        while(sleep_dat)                       //å¦‚æœä¼‘çœ æ—¶é—´ä¸ä¸º0ï¼Œè¯´æ˜è¢«æ‰“æ–­ï¼Œç»§ç»­ä¼‘çœ 
  114   1          {
  115   2              Sleep_delay_HalfMs(sleep_dat);   //è®¾ç½®ä¼‘çœ çš„å€¼
  116   2              _nop_();
  117   2              _nop_();
  118   2              _nop_();
  119   2              _nop_();
  120   2              PD = 1;                            //MCUè¿›å…¥æ‰ç”µæ¨¡å¼
  121   2              _nop_();
  122   2              _nop_();
  123   2              _nop_();
  124   2              _nop_();
  125   2              WKTCH &= 0x7f;                    //æ‰ç”µå”¤é†’å¯„å­˜å™¨åœæ­¢è®¡æ—¶
C251 COMPILER V5.60.0,  time                                                               25/04/24  00:23:37  PAGE 3   

  126   2              kk = WKTCH;                       //è¯»å–æ‰ç”µå”¤é†’å¯„å­˜å™¨å†…çš„ å·²ç»ä¼‘çœ çš„å¤šä¹…çš„å€¼
  127   2              kk = kk*256;
  128   2              kk = kk + WKTCL;
  129   2              if(kk == 0)                       //å¦‚æœä¸º0ï¼Œè¯´æ˜å·²ç»æŒ‰ç…§ä»»åŠ¡ä¼‘çœ äº†è¶³å¤Ÿçš„æ—¶é—´
  130   2              {
  131   3                  sleep_dat = 0;
  132   3              }
  133   2              else
  134   2              {
  135   3                sleep_dat = sleep_dat - kk;   //å¦‚æœä¸ä¸º0ï¼Œè¯´æ˜ä¼‘çœ è¢«æ‰“æ–­ï¼Œè®¾å®šå€¼ - å½“å‰å·²ç»ä¼‘ç
             -œ äº†å¤šä¹… = è¿˜éœ€è¦ä¼‘çœ å¤šä¹…
  136   3              }
  137   2          }
  138   1      }
  139          
  140          
  141          
  142          
  143          
  144          
  145          
  146          //========================================================================
  147          // å‡½æ•°: Sleep_Thread()
  148          // æè¿°: ç¡çœ ä»»åŠ¡ï¼Œå½“æœ‰ä¼‘çœ ä»»åŠ¡çš„æ—¶å€™ï¼Œå¯åŠ¨æ‰ç”µå”¤é†’å¯„å­˜å™¨ï¼Œæ²¡æœ‰ä»»åŠ¡çš„è¯ï
             -¼Œè¿›å…¥ä¼‘çœ ä¸å†å”¤é†’
  149          // å‚æ•°: 
  150          // è¿”å›: 
  151          // ç‰ˆæœ¬: 
  152          // æ—¥æœŸ: 2013-4-1
  153          // å¤‡æ³¨:
  154          //========================================================================
  155          
  156          void Sleep_Thread()
  157          {
  158   1        if(RFF() > 0)//å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå­˜åœ¨ä»»åŠ¡
  159   1          {
  160   2              Sleep_delay_Time(Sleep_Queue[0]);       //å°†ä»»åŠ¡éœ€è¦ç­‰å¾…çš„æ—¶é—´è£…å¡«è¿›æ‰ç”µå”¤é†’å¯„å
             -­˜å™¨
  161   2          }
  162   1          else
  163   1          {
  164   2              WKTCH &= 0x7f;                          //å…³é—­æ‰ç”µå”¤é†’æ—¶é’Ÿ
  165   2      
  166   2      
  167   2              _nop_();
  168   2              _nop_();
  169   2              _nop_();
  170   2              _nop_();
  171   2              PCON = 0x02;                            //MCUè¿›å…¥æ‰ç”µæ¨¡å¼
  172   2              _nop_();
  173   2              _nop_();
  174   2              _nop_();
  175   2              _nop_();
  176   2          }
  177   1      }
  178          
  179          
  180          
  181          
  182          
  183          
  184          
  185          
  186          
  187          
  188          
C251 COMPILER V5.60.0,  time                                                               25/04/24  00:23:37  PAGE 4   

  189          
  190          
  191          
  192          
  193          
  194          
  195          
  196          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       160     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
