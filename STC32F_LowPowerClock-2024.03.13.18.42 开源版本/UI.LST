C251 COMPILER V5.60.0,  UI                                                                 25/04/24  00:23:38  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE UI
OBJECT MODULE PLACED IN UI.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE UI.c XSMALL OPTIMIZE(9,SPEED) BROWSE DEBUG TABS(2) 

stmt  level    source

    1          #include "UI.h"
    2          #include "OLED.h"
    3          #include "DATA.h"
    4          #include "Main_Menu.h"
    5          #include "TV_Mode.h"
    6          #include "SecondaryMenu.h"
    7          #include "ThreeMenu.h"
    8          #include "CompassMenu.h"
    9          #include "BMC050.h"
   10          #include "SleepMode.h"
   11          #include "FlashLight.h"
   12          
   13          
   14          extern u16 dat00[System_data_num];
   15          extern u16 dat00_low[System_data_num];
   16          extern u8 xdata dat00_flag[System_data_num];
   17          
   18          
   19          /****************************** 睡眠寄存器组 ***********************************/
   20          extern u16 Sleep_Queue[Sleep_queue_num];
   21          extern u16 Sleep_Queue_count;
   22          extern u16 Sleep_Queue_count_target;
   23          extern u16 Sleep_Queue_task[Sleep_queue_num];
   24          
   25          //========================================================================
   26          // 函数: UI_switch()
   27          // 描述: UI界面切换
   28          // 参数:
   29          // 返回:
   30          // 版本: V1.0 2023.02.05
   31          //========================================================================
   32          void UI_switch()
   33          {
   34   1      
   35   1          if((dat00[0] & 0x0040) ||  (dat00[0x37] == 0))//界面更新 + 休眠运行允许1S任务运行标志
             -位
   36   1          {
   37   2              if(dat00_flag[0x0010])//界面更新
   38   2              {
   39   3                  
   40   3                  if(dat00[0x0010] == 0x0000 && dat00[0x1A] == 0)//进入主菜单
   41   3                  {
   42   4                      if(dat00_low[0x0010] == 0x0005)//从指南针退出来
   43   4                      {
   44   5                         Magnetometer_Close();//挂起传感器
   45   5                         dat00_low[0x0010] = dat00[0x0010];
   46   5                      }
   47   4                      else if(dat00_low[0x0010] == 12)//从手电筒退出
   48   4                      {
   49   5                         dat00[0x0051] = dat00_low[0x0051];
   50   5                         dat00[0x0052] = dat00_low[0x0052]; 
   51   5                         dat00_flag[0x0051] = 1;
   52   5                         dat00_flag[0x0052] = 1;
   53   5                         dat00_low[0x0010] = dat00[0x0010];                 
   54   5                      }
   55   4                      OLED_Fill(0x00); //初始清屏
   56   4                      IU_Main_Menu_Switch();
   57   4                      UI_main(1);
   58   4                  }
C251 COMPILER V5.60.0,  UI                                                                 25/04/24  00:23:38  PAGE 2   

   59   3                  else if((dat00[0x0010] >= 0x0001 && dat00[0x1A] == 0 && dat00[0x0010] <= 0x0010 && (dat00[0x0
             -010] != 0x0005) && (dat00[0x0010] != 12)))//在主菜单选中非指南针和手电筒
   60   3                  {
   61   4                      OLED_Fill(0x00); //初始清屏
   62   4                      IU_Main_Menu_Switch();
   63   4                      UI_SecondaryMenu(1);
   64   4                  }
   65   3                  else if(dat00[0x1A] == 1)//在三级菜单
   66   3                  {
   67   4                      IU_Main_Menu_Switch();
   68   4                      dat00[0x1B] = dat00_low[GET_SCdat3()];
   69   4                      UI_ThreeMenu();
   70   4      
   71   4                  }
   72   3                  else if(dat00[0x0010] == 0x0020 && dat00[0x1A] == 0)//在TV模式-时间显示
   73   3                  {
   74   4                      //dat00[0x002D] = 0;
   75   4                      OLED_Fill(0x00); //初始清屏
   76   4                      IU_Main_Menu_Switch();
   77   4                      TVMode_int();
   78   4      
   79   4                  }
   80   3                  else if(dat00[0x0010] == 0x0021 && dat00[0x1A] == 0)//在TV模式-温湿度气压
   81   3                  {
   82   4      
   83   4                      OLED_Fill(0x00); //初始清屏
   84   4                      IU_Main_Menu_Switch();
   85   4                      TVMode2_int();
   86   4      
   87   4                  }
   88   3                  else if(dat00[0x0010] == 0x0022 && dat00[0x1A] == 0)//在TV模式-电量显示
   89   3                  {
   90   4                      OLED_Fill(0x00); //初始清屏
   91   4                      IU_Main_Menu_Switch();
   92   4                      TVMode3_int();
   93   4      
   94   4                  }
   95   3                  else if(dat00[0x1A] == 0 &&  dat00[0x0010] == 0x0005)//进入指南针
   96   3                  {
   97   4                      OLED_Fill(0x00); //初始清屏
   98   4                      UI_CompassMenu_int();
   99   4                  }
  100   3                  else if(dat00[0x1A] == 0 &&  dat00[0x0010] == 12)//进入手电筒
  101   3                  {
  102   4                      FlashLight_int(); 
  103   4                  }           
  104   3                  
  105   3                  
  106   3                  dat00_flag[0x0010] = 0;
  107   3              }
  108   2          }
  109   1      
  110   1      }
  111          
  112          
  113          
  114          //========================================================================
  115          // 函数: IU_Thread()
  116          // 描述: UI局部刷新任务
  117          // 参数:
  118          // 返回:
  119          // 版本: V1.0 2024.02.12
  120          //========================================================================
  121          void IU_Thread()
  122          {
  123   1          if((dat00[0] & 0x0040) ||  (dat00[0x37] == 0))
C251 COMPILER V5.60.0,  UI                                                                 25/04/24  00:23:38  PAGE 3   

  124   1          {
  125   2              if(Sleep_Queue_task[0] & 0x0001)
  126   2              {
  127   3                  IU_Main_Menu();
  128   3                  IU_Secondary();
  129   3                  IU_TVMode();
  130   3                  UI_CompassMenu_time();
  131   3                  UI_SecondaryMenu_G_1();
  132   3                  Sleep_Queue_task[0] &= ~0x0001;
  133   3              }
  134   2          }
  135   1      
  136   1      }
  137          
  138          
  139          
  140          
  141          
  142          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       361     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
